name: Unit Testing

on:
  push:
  pull_request:
    branches:
      - dev

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
     - name: checkout the code
       uses: actions/checkout@v4

     - name: Setup PHP with pre-release PECL extension
       uses: shivammathur/setup-php@v2
       with:
         php-version: '8.3'
       
     - name: composer install
       run: |
         composer install
     - name: create environment 
       run: |
           cp .env.ci .env
           cp .env.ci  .env.testing
     - name: install mysql 
       run: |
        docker run -d \
        -e MYSQL_ALLOW_EMPTY_PASSWORD=false \
        -e MYSQL_ROOT_PASSWORD=password \
        -e MYSQL_DATABASE=test \
        -p 3306:3306 \
         mysql:latest

     - name: Check docker status
       run: |
        docker ps
     - name: Migrate the database
       run: |
        php artisan migrate

     - name: compilaction 
       run: |
         php artisan key:generate

     - name: Run the unit test
       run: |
        php artisan test

